version: '3'

networks:
    elknetwork:

services:
  logstash:
    image: logstash:7.9.3
    container_name: logstash
    volumes:
     - "./logstash/config/logstash.conf:/etc/logstash/logstash.conf:ro"
    ports:
     - 5046:5046
     - 12201-12203:12201-12203/udp     
    networks:
     - elknetwork   
    environment:
     - "LS_JAVA_OPTS= -Xms512m -Xmx512m"
     - "XPACK_MONITORING_ENABLED= false"
    command: logstash -f /etc/logstash/logstash.conf
    links: 
        - es01  
  es01:
    image: elasticsearch:7.9.3
    container_name: es01
    networks:
     - elknetwork
    environment:
     - node.name=es01
     - cluster.name=es-docker-cluster
     - discovery.seed_hosts=es01,es02
     - cluster.initial_master_nodes=es01
     - "ES_JAVA_OPTS= -Xms512m -Xmx512m"
    volumes:
      - ./elasticsearch/data:/usr/share/elasticsearch/data
    ports:
      - 9200:9200
      - 9300:9300 
  kib01:
    image: kibana:7.9.3
    container_name: kib01
    ports:
      - 5601:5601
    environment:
      ELASTICSEARCH_URL: http://es01:9200
      ELASTICSEARCH_HOSTS: http://es01:9200
    networks:
      - elknetwork
